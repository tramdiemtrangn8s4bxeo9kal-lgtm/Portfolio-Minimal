<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>WebDstat GitHub Pages</title>
<style>
body {
  background: #111;
  color: #0f0;
  font-family: "Courier New", monospace;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  min-height: 100vh;
  padding: 20px;
  overflow-x: hidden;
}
h1 { font-size: 2em; margin-bottom: 10px; }
#target { width: 300px; padding: 5px; margin-bottom: 10px; background:#000; color:#0f0; border:1px solid #0f0; }
button { padding: 10px 20px; margin-bottom: 20px; background:#000; color:#0f0; border:1px solid #0f0; cursor:pointer; }
button:hover { background:#0f0; color:#000; }
#stats { font-size: 1.5em; margin-bottom: 20px; }
canvas { background:#000; border:1px solid #0f0; }
@keyframes blink { 0%, 100% { opacity:1 } 50% { opacity:0 } }
.blink { animation: blink 1s step-start infinite; }
</style>
</head>
<body>
<h1>WebDstat 100% GitHub Pages</h1>
<input id="target" placeholder="Nhập URL cần test">
<button id="startBtn">Start</button>
<div id="stats">Requests: 0 <span class="blink">█</span></div>
<canvas id="chart" width="600" height="300"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let requests = 0;
let interval;
let history = [];
const maxPoints = 50;

const ctx = document.getElementById('chart').getContext('2d');
const chart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: Array(maxPoints).fill(''),
        datasets: [{
            label: 'Requests/s',
            data: Array(maxPoints).fill(0),
            borderColor: '#0f0',
            backgroundColor: 'rgba(0,255,0,0.1)',
            tension: 0.3
        }]
    },
    options: {
        responsive: false,
        scales: {
            x: { display:false },
            y: { min:0 }
        },
        plugins: { legend:{ labels:{ color:'#0f0' } } }
    }
});

document.getElementById('startBtn').onclick = () => {
    const url = document.getElementById('target').value;
    if(!url) return alert('Nhập URL trước!');
    requests = 0;
    history = [];
    chart.data.datasets[0].data.fill(0);
    chart.update();
    clearInterval(interval);

    // Đếm request
    interval = setInterval(async () => {
        try {
            await fetch(url, {mode: 'no-cors'});
            requests++;
        } catch(e) {}
    }, 100); // 10 requests/s 1 tab

    // Cập nhật stats & chart mỗi giây
    setInterval(() => {
        history.push(requests);
        if(history.length>maxPoints) history.shift();
        chart.data.datasets[0].data = history.concat(Array(maxPoints-history.length).fill(0));
        chart.update();
        document.getElementById('stats').innerText = `Requests: ${requests} █`;
        requests = 0;
    }, 1000);
};
</script>
</body>
</html>
